# SCHEMAS_JSON.md (updated)

Schemas for JSON artifacts generated by `src/utils/convert_to_gantt.py`.

**Outputs covered**
- `gantt_tasks_by_plant.json`
- `gantt_dependencies_by_plant.json`
- `plants.json`
- `load_forecast_by_region.json`

---

## 1) `gantt_tasks_by_plant.json`

**Type:** `Array<Task>` — one row per task/milestone/sustainment/procurement item, grouped by plant via `plantId`.

### 1.1 Task (common fields)

| Field | Type | Required | Notes |
|------|------|:--------:|-------|
| `id` | string | ✓ | Canonical task id (e.g., `P-…`, `M-…`, `SW-…`, `PSC-…`, `SSC-…`). |
| `parentId` | string \| null |  | Parent task id; projects usually have `null`, milestones point to their project. |
| `title` | string | ✓ | Task or milestone label. |
| `start` | string (ISO date) \| null |  | Normalized start used for Gantt views. |
| `end` | string (ISO date) \| null |  | Normalized end used for Gantt views. |
| `plantId` | string \| null |  | Plant anchor; inherited from parent when missing upstream. |
| `risk_score` | number \| null |  | Propagated from parent if not present. |
| `type` | string \| null |  | High-level category when available (e.g., `"project"`, `"milestone"`, `"sustainment"`). |

### 1.2 Capacity / Sustainment augmentation

(Emitted for capacity-affecting milestones or sustainment items.)

| Field | Type | Notes |
|------|------|-------|
| `kind` | `"build"` \| `"retire"` \| `"modernize"` \| `"sustainment"` \| null | Interpreted from milestone semantics or sustainment sources. |
| `effective_date` | string \| null | Capacity effective date (capacity milestones). |
| `delta_mw` | number \| null | Nameplate change (+build/modernize, −retire). |
| `delta_reliable_mw` | number \| null | Reliable capacity change if provided. |
| `condition_score_delta` | number \| null | Optional condition impact. |
| `start_date` | string \| null | Sustainment window start. |
| `end_date` | string \| null | Sustainment window end. |
| `derate_pct` | number \| string \| null | Derate magnitude (accepts `0..1`, `0..100`, or `%`). |
| `for_bump` | number \| string \| null | Forced outage rate bump. |
| `expedite_days` | number \| null | Procurement/resource timing (when applicable). |
| `lead_time_days` | number \| null | Procurement/resource timing (when applicable). |
| `procurement_start_date` | string \| null | Procurement/resource timing (when applicable). |

---

## 2) `gantt_dependencies_by_plant.json`

**Type:** `Array<Dependency>` — directed edges between tasks after alias/anchor resolution.

### 2.1 Dependency

| Field | Type | Required | Notes |
|------|------|:--------:|-------|
| `id` | number | ✓ | Sequential id assigned at export. |
| `predecessorId` | string | ✓ | Source task id. |
| `successorId` | string | ✓ | Target task id. |
| `type` | `0` \| `1` \| `2` \| `3` | ✓ | PDM: `0=FS`, `1=SS`, `2=FF`, `3=SF`. |

---

## 3) `plants.json`

**Type:** `Array<Plant>` — one row per plant; includes sustainment and policy overlays.

### 3.1 Plant

| Field | Type | Notes |
|------|------|-------|
| `plant_id` | string | Canonical plant key. |
| `plant_name` | string | Human-readable name. |
| `eia_plant_id` | number \| string | EIA identifier if available. |
| `fuel` | string | Fuel/technology. |
| `status` | string | Plant lifecycle label. |
| `nameplate_mw` | number | Installed capacity. |
| `reliable_mw` | number | Reliable capacity estimate. |
| `condition_score` | number | 0–100 condition index. |
| `annual_sustainment_opex_$` | number | Annual sustainment OPEX estimate. |
| `infra_backlog_$M` | number | Infra backlog in $MM. |
| `forced_outage_rate` | number | Percent or 0–100 scaled in inputs. |
| `age_years` | number | Age in years. |
| `id`, `name`, `capacity_mw`, `start_date`, `retire_date`, `owner`, `region`, `timezone` | various | Convenience carry-throughs. |
| `reliability.base_for` | number | Baseline FOR used for profiles. |
| `baseline` | object | `{ date: string, nameplate_mw: number }`. |
| `profile_meta.same_day_order` | string[] | Rule for same-day capacity events; default `["retire","modernize","build"]`. |
| `profile.capacity`, `profile.for` | array | Reserved for per-plant time series (often empty in exports). |

### 3.2 `sustainment.needs[]` (normalized)

Per-plant sustainment catalog row after aliasing & normalization. Each `need` is a generator-ready description used by `applySustainmentTasksFromPlants` to synthesize sustainment work and supply-chain tasks.

| Field | Type | Required | Notes |
|------|------|:--------:|-------|
| `id` | string | ✓ | Canonical plant-scoped need id (`SUST_<plant>_<slug>`). Used by downstream generators. |
| `need_id` | string |  | Original/canonical id from the source catalog (kept for traceability). |
| `plant_id` | string |  | Plant key this need is associated with. |
| `category` | string | ✓ | Work category label (human readable). |
| `work_name` | string |  | Optional verbose name/description. |
| `cadence_days` | number |  | Recurrence in days (may be derived from cadence_months upstream). |
| `default_duration_days` | number |  | Typical execution window for this need. |
| `occurrence_cost_usd` | number |  | Estimated cost per occurrence. |
| `risk_if_deferred` | string \| number |  | Qualitative or numeric risk indicator. |
| `anchor` | string |  | Optional anchor for first occurrence (e.g. `"plantStartPlusLead"`). |
| `notes` | string \| null |  | Free-text notes (e.g., catalog provenance). |
| `effect_key` | string \| null |  | Lookup key into sustainment_effects (e.g., `"gas:combustor_hardware_refresh"`). |
| `resources` | Array\<object> |  | Parsed resource requirements. Typical fields: `resource_id`, `qty_per_day`, `duration_days`, `start_offset_days`. |
| `supply_chain` | Array\<object> |  | Parsed supply-chain items: `component`, `vendor_type`, `lead_time_days`, `expedite_days`, `unit_cost_estimate_usd`, etc. |
| `dep_templates` | Array\<object> |  | Parsed dependency templates (e.g., `to_kind`, `to_ref`, `type`, `lag_days`, `severity`). Used by sustainment generators. |
| `trigger_rules` | object |  | Usually `{ "type": "calendar", "cadence_days": ... }`. May be omitted if implicit. |
| `task_template` | object |  | Optional template hints; commonly `{ "duration_days": <number> }`. |
| `derate_pct` | number \| string \| null | Capacity derate applied while this need’s work is in progress. Accepts `0–1`, `0–100`, or `%`; normalized downstream. |
| `for_bump` | number \| string \| null | Incremental forced-outage-rate bump associated with this need. |

**Legacy passthroughs**

Some rows may still include `resources_json`, `supply_chain_json`, `dep_templates_json`, or `policy_refs_json` as raw strings for traceability; consumers should prefer the parsed `resources`, `supply_chain`, and `dep_templates` fields where present.


### 3.3 `sustainment.policy_constraints[]`

Policy overlays attached at plant/region scopes.

| Field | Type | Notes |
|------|------|-------|
| `constraint_id` | string | Unique key; may include scope prefix. |
| `scope` | `"plant"` \| `"region"` | Where the constraint applies. |
| `constraint_type` | string | Category (`Environmental`, `Interconnection`, `Reliability`, `Trade/Content`, etc.). |
| `constraint_name` | string | Human-readable label. |
| `pattern` | string | Enforcement pattern (`blackout`, `permit_gate`, `buffer_days`, `derate_pct`, `cost_adder`, …). |
| `target` | string | Target class (`"milestone"` or `"supply_chain"`). |
| `value` | string | Free-form policy value (e.g., `notice>=14d`, `22:00-06:00; Aug01-Oct15`, `"0.05"`). |
| `effective_from` | string | Start date string as provided. |
| `effective_to` | string | End date string as provided. |
| `notes` | string \| null | Free text note. |

---

## 4) `load_forecast_by_region.json`

**Type:** `Record<Region, Array<ForecastPoint>>` — each key is a region (e.g., `"ERCOT"`), value is an array of `{date, load_mw}`. Date granularity may be monthly and/or daily depending on the source.

### 4.1 `ForecastPoint`

| Field | Type | Notes |
|------|------|-------|
| `date` | string (`YYYY-MM-DD`) | Timeseries date stamp. |
| `load_mw` | number | Forecasted load for the date. |

---

### Version notes
- Sustainment needs now include **`occurrence_cost_usd`**, **`risk_if_deferred`**, and normalized **`resources` / `supply_chain` / `dep_templates`** arrays for downstream scheduling and prioritization.
- Capacity-effect metadata **`derate_pct`** and **`for_bump`** are attached at the sustainment-need level (and propagated into generated sustainment tasks).
- Some legacy passthrough columns (e.g. `*_json`) may still appear on a subset of rows for traceability; consumers should prefer the normalized fields documented above.

